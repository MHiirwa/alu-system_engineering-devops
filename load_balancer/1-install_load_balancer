#!/usr/bin/env bash
# Install and configure HAProxy on lb-01 to load balance between web-01 and web-02

# Exit if any command fails
set -e

# Ensure script is run as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run as root"
  exit 1
fi

# Update and install HAProxy
apt-get update -y
apt-get install -y haproxy

# Enable HAProxy to start using init script
sed -i 's/ENABLED=0/ENABLED=1/' /etc/default/haproxy

# Backup original configuration if not already done
if [ ! -f /etc/haproxy/haproxy.cfg.bak ]; then
  cp /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bak
fi

# Write new HAProxy

